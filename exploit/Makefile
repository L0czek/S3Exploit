CXX         ?= g++
SOURCE_DIR   = $(shell pwd)
SRC_DIR      = $(SOURCE_DIR)/src
INC_DIR      = $(SOURCE_DIR)/inc
OBJ_DIR      = $(SOURCE_DIR)/obj
OUT_BINARY   = $(SOURCE_DIR)/exploit

ADD_INC_DIRS?= 
INCLUDES     = $(INC_DIR) $(ADD_INC_DIRS)
INC_PARAMS   = $(foreach path, $(INCLUDES), -I$(path))
SRC_FILES    = $(wildcard src/*.cc)
OBJ_FILES    = $(SRC_FILES:src%.cc=obj%.o)

CXX_FLAGS    = -Wall -Wextra -static -std=c++17 $(INC_PARAMS)
LD_FLAGS     = -static 

.PHONY: build
build: $(OUT_BINARY)

obj/%.o: src/%.cc
	@if ! [ -d $(OBJ_DIR) ]; then \
		mkdir $(OBJ_DIR); \
	fi;
	@echo "  CXX   $^"
	@$(CXX) -c $(CXX_FLAGS) $^ -o $@

$(OUT_BINARY): $(OBJ_FILES)
	@echo "   LD   $@"
	@$(CXX) $(LD_FLAGS) $(OBJ_FILES) -o $(OUT_BINARY)

.PHONY: clean
clean:
	rm -rf $(OBJ_DIR)
	rm -f $(OUT_BINARY)




