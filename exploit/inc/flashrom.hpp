#ifndef __FLASHROM_HPP__
#define __FLASHROM_HPP__

extern "C" {
#include <libflashrom.h>
}
#include <string>
#include <memory>

class Flashrom {
    flashrom_programmer* programmer = nullptr;
    flashrom_flashctx* flash_ctx = nullptr;
    flashrom_layout* flash_layout = nullptr;

    Flashrom();
    Flashrom(const Flashrom& ) = delete;
    Flashrom(Flashrom&& );
public:
    ~Flashrom();

    static std::unique_ptr<Flashrom> init(bool perform_self_check = true);

    bool setup_programmer();
    bool setup_flash_chip();
    bool setup_layout();

    std::string pad_to_flash_size(const std::string& payload, std::size_t offset);
    bool flash_bios(std::string& bios_data);
    std::size_t flash_size();
};

#endif
