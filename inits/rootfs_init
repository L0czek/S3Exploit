#!/bin/sh

ln -s /mnt/lib /lib
ulimit -c 9999999
echo "Attempting to load kernel module."
if ! insmod ./s3exploit.ko; then
    echo "Error, cannot load module, spawnng shell.";
    exec sh;
fi

LD_LINUX=`find / -name 'ld-linux*'`

echo "Loaded kernel module, executing exploit."
$LD_LINUX ./exploit

echo "Exploit exited with $? error code, spawning shell."
exec sh
