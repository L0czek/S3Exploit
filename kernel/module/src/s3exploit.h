#ifndef __S3EXPLOIT_H__
#define __S3EXPLOIT_H__

#include <linux/types.h>
#include "s3bootscript.h"

struct s3exploit;
struct spi_flash_info;
typedef int (*callback_t)(struct Header *, void *data);

struct s3exploit *s3exploit_init(void);
void s3exploit_deinit(struct s3exploit *);

phys_addr_t s3exploit_get_bootscript_addr(struct s3exploit *);
size_t s3exploit_get_bootscript_size(struct s3exploit *);
uint8_t *s3exploit_get_bootscript_copy(struct s3exploit* );
void s3exploit_for_each_instruction(struct s3exploit *, callback_t callback, void *data);

int s3exploit_trigger_vuln(struct s3exploit *, size_t wakeup_after);
int s3exploit_check_target(struct s3exploit *);
int s3exploit_get_flash_info(struct s3exploit *, struct spi_flash_info*);
int s3exploit_set_flash_info(struct s3exploit *, struct spi_flash_info*);

int s3exploit_reset_flockdn_bit(struct s3exploit *);

int s3exploit_overwrite_bios(struct s3exploit *, void *data, uint32_t size, uint32_t offset);

#endif
